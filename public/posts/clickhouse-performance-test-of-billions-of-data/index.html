<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="http://localhost:1313/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    Clickhouse 亿级数据性能测试 | Asimov Ai
    
</title>

<link rel="canonical" href="http://localhost:1313/posts/clickhouse-performance-test-of-billions-of-data/"/>

<meta property="og:url" content="http://localhost:1313/posts/clickhouse-performance-test-of-billions-of-data/">
  <meta property="og:site_name" content="Asimov Ai">
  <meta property="og:title" content="Clickhouse 亿级数据性能测试">
  <meta property="og:description" content="一个单表 6 亿数据量的性能测试，有做超大数据量分析技术选型需求的朋友可以参考。">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-03-15T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-03-15T00:00:00+00:00">
    <meta property="article:tag" content="Database">
    <meta property="article:tag" content="Java">












<link rel="stylesheet" href="/assets/combined.min.a160d2600f27eb793ee832ae0b2ebd5d2ae357db3be08cde44d5af70fa231477.css" media="all">











    


   
    


</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="http://localhost:1313/">Asimov Ai</a>
    </h1>

    <div class="header-menu">
        

        
        

        <p
            class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/projects" >
                /projects
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/posts/">Posts</a><span class="breadcrumbs-separator">/</span>
        <a href="/posts/clickhouse-performance-test-of-billions-of-data/">Clickhouse 亿级数据性能测试</a></div>


<div >
  <article>
    <header class="single-intro-container">
        
        <h1 class="single-title">Clickhouse 亿级数据性能测试</h1>
        <p class="single-summary">一个单表 6 亿数据量的性能测试，有做超大数据量分析技术选型需求的朋友可以参考。</p>
        
        <div class="single-subsummary">
          
          <div>
            
            <p class="single-date">
              <time datetime="2021-03-15T00:00:00&#43;00:00">March 15, 2021</time>
              &nbsp; · &nbsp;5 min read
            </p>
          </div>
        </div>
        
    </header>    
        <div class="single-tags"><span>
                  <a href="http://localhost:1313/tags/database/">#Database</a>
                </span><span>
                  <a href="http://localhost:1313/tags/java/">#Java</a>
                </span>
        </div>
      <aside class="toc">
        <p><strong>Table of contents</strong></p>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#服务器信息">服务器信息</a></li>
    <li><a href="#clickhouse-信息">Clickhouse 信息</a></li>
    <li><a href="#测试情况">测试情况</a>
      <ul>
        <li><a href="#数据量和空间占用">数据量和空间占用</a></li>
        <li><a href="#查询性能测试详情">查询性能测试详情</a></li>
      </ul>
    </li>
    <li><a href="#性能测试结果汇总">性能测试结果汇总</a></li>
  </ul>
</nav>
      </aside>
    
    <div class="single-content">
      <p>Clickhouse 在数据分析技术领域早已声名远扬，如果还不知道可以 <a href="https://clickhouse.tech/docs/zh/">点这里</a> 了解下。</p>
<p>最近由于项目需求使用到了 clickhouse 做分析数据库，于是用测试环境做了一个单表 6 亿数据量的性能测试，记录一下测试结果，有做超大数据量分析技术选型需求的朋友可以参考下。</p>
<h2 class="heading" id="服务器信息">
  服务器信息
  <a class="anchor" href="#%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%bf%a1%e6%81%af">#</a>
</h2>
<ul>
<li>CPU：Intel Xeon Gold 6240 @ 8x 2.594GHz</li>
<li>内存：32G</li>
<li>系统：CentOS 7.6</li>
<li>Linux内核版本：3.10.0</li>
<li>磁盘类型：机械硬盘</li>
<li>文件系统：ext4</li>
</ul>
<h2 class="heading" id="clickhouse-信息">
  Clickhouse 信息
  <a class="anchor" href="#clickhouse-%e4%bf%a1%e6%81%af">#</a>
</h2>
<ul>
<li>部署方式：单机部署</li>
<li>版本：20.8.11.17</li>
</ul>
<h2 class="heading" id="测试情况">
  测试情况
  <a class="anchor" href="#%e6%b5%8b%e8%af%95%e6%83%85%e5%86%b5">#</a>
</h2>
<blockquote>
<p>测试数据和测试方法来自 clickshouse 官方的 <a href="https://clickhouse.tech/docs/en/getting-started/example-datasets/star-schema/">Star Schema Benchmark</a></p></blockquote>
<p>按照官方指导造出了测试数据之后，先看一下数据量和空间占用情况。</p>
<h3 class="heading" id="数据量和空间占用">
  数据量和空间占用
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e9%87%8f%e5%92%8c%e7%a9%ba%e9%97%b4%e5%8d%a0%e7%94%a8">#</a>
</h3>

<div class="table-outer">
    <table>
        <thead>
            <tr>
                <th>表名</th>
                <th>列数</th>
                <th>数据行数</th>
                <th>原始大小</th>
                <th>压缩大小</th>
                <th>压缩率</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>supplier</td>
                <td>6</td>
                <td>200,000</td>
                <td>11.07 MiB</td>
                <td>7.53 MiB</td>
                <td>68</td>
            </tr>
            <tr>
                <td>customer</td>
                <td>7</td>
                <td>3,000,000</td>
                <td>168.83 MiB</td>
                <td>114.72 MiB</td>
                <td>68</td>
            </tr>
            <tr>
                <td>part</td>
                <td>8</td>
                <td>1,400,000</td>
                <td>34.29 MiB</td>
                <td>24.08 MiB</td>
                <td>70</td>
            </tr>
            <tr>
                <td>lineorder</td>
                <td>16</td>
                <td>600,037,902</td>
                <td>24.03 GiB</td>
                <td>16.67 GiB</td>
                <td>69</td>
            </tr>
            <tr>
                <td>lineorder_flat</td>
                <td>37</td>
                <td>688,552,212</td>
                <td>111.38 GiB</td>
                <td>61.05 GiB</td>
                <td>55</td>
            </tr>
        </tbody>
    </table>
</div><p>可以看到 clickhouse 的压缩率很高，压缩率都在 50 以上，基本可以达到 70 左右。数据体积的减小可以非常有效的减少磁盘空间占用、提高 I/O 性能，这对整体查询性能的提升非常有效。</p>
<p>supplier、customer、part、lineorder 为一个简单的「供应商-客户-订单-地区」的星型模型，lineorder_flat 为根据这个星型模型数据关系合并的大宽表，所有分析都直接在这张大宽表中执行，减少不必要的表关联，符合我们实际工作中的分析建表逻辑。</p>
<p>以下性能测试的所有分析 SQL 都在这张大宽表中运行，未进行表关联查询。</p>
<h3 class="heading" id="查询性能测试详情">
  查询性能测试详情
  <a class="anchor" href="#%e6%9f%a5%e8%af%a2%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e8%af%a6%e6%83%85">#</a>
</h3>
<h4 class="heading" id="query-11">
  Query 1.1
  <a class="anchor" href="#query-11">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">SELECT</span> <span style="font-weight:bold;text-decoration:underline">sum</span>(LO_EXTENDEDPRICE * LO_DISCOUNT) <span style="font-weight:bold;text-decoration:underline">AS</span> revenue
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">FROM</span> lineorder_flat
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">WHERE</span> (toYear(LO_ORDERDATE) = 1993) <span style="font-weight:bold;text-decoration:underline">AND</span> ((LO_DISCOUNT &gt;= 1) <span style="font-weight:bold;text-decoration:underline">AND</span> (LO_DISCOUNT &lt;= 3)) <span style="font-weight:bold;text-decoration:underline">AND</span> (LO_QUANTITY &lt; 25)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">┌────────</span>revenue<span style="">─┐</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 44652567249651 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">└────────────────┘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>1 <span style="font-weight:bold;text-decoration:underline">rows</span> <span style="font-weight:bold;text-decoration:underline">in</span> <span style="font-weight:bold;text-decoration:underline">set</span>. Elapsed: 0.242 sec. Processed 91.01 million <span style="font-weight:bold;text-decoration:underline">rows</span>, 728.06 MB (375.91 million <span style="font-weight:bold;text-decoration:underline">rows</span>/s., 3.01 GB/s.)
</span></span></code></pre></div><p><strong>扫描行数：91,010,000</strong> <em>大约9100万</em></p>
<p><strong>耗时(秒)：0.242</strong></p>
<p><strong>查询列数：2</strong></p>
<p><strong>结果行数：1</strong></p>
<h4 class="heading" id="query-12">
  Query 1.2
  <a class="anchor" href="#query-12">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">SELECT</span> <span style="font-weight:bold;text-decoration:underline">sum</span>(LO_EXTENDEDPRICE * LO_DISCOUNT) <span style="font-weight:bold;text-decoration:underline">AS</span> revenue
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">FROM</span> lineorder_flat
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">WHERE</span> (toYYYYMM(LO_ORDERDATE) = 199401) <span style="font-weight:bold;text-decoration:underline">AND</span> ((LO_DISCOUNT &gt;= 4) <span style="font-weight:bold;text-decoration:underline">AND</span> (LO_DISCOUNT &lt;= 6)) <span style="font-weight:bold;text-decoration:underline">AND</span> ((LO_QUANTITY &gt;= 26) <span style="font-weight:bold;text-decoration:underline">AND</span> (LO_QUANTITY &lt;= 35))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">┌───────</span>revenue<span style="">─┐</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 9624332170119 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">└───────────────┘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>1 <span style="font-weight:bold;text-decoration:underline">rows</span> <span style="font-weight:bold;text-decoration:underline">in</span> <span style="font-weight:bold;text-decoration:underline">set</span>. Elapsed: 0.040 sec. Processed 7.75 million <span style="font-weight:bold;text-decoration:underline">rows</span>, 61.96 MB (191.44 million <span style="font-weight:bold;text-decoration:underline">rows</span>/s., 1.53 GB/s.)
</span></span></code></pre></div><p><strong>扫描行数：7,750,000</strong> <em>775万</em></p>
<p><strong>耗时(秒)：0.040</strong></p>
<p><strong>查询列数：2</strong></p>
<p><strong>返回行数：1</strong></p>
<h4 class="heading" id="query-21">
  Query 2.1
  <a class="anchor" href="#query-21">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">SELECT</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">sum</span>(LO_REVENUE),
</span></span><span style="display:flex;"><span>    toYear(LO_ORDERDATE) <span style="font-weight:bold;text-decoration:underline">AS</span> <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    P_BRAND
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">FROM</span> lineorder_flat
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">WHERE</span> (P_CATEGORY = <span style="color:#666;font-style:italic">&#39;MFGR#12&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> (S_REGION = <span style="color:#666;font-style:italic">&#39;AMERICA&#39;</span>)
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">GROUP</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    P_BRAND
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">ORDER</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span> <span style="font-weight:bold;text-decoration:underline">ASC</span>,
</span></span><span style="display:flex;"><span>    P_BRAND <span style="font-weight:bold;text-decoration:underline">ASC</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="">┌─</span><span style="font-weight:bold;text-decoration:underline">sum</span>(LO_REVENUE)<span style="">─┬─</span><span style="font-weight:bold;text-decoration:underline">year</span><span style="">─┬─</span>P_BRAND<span style="">───┐</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     64420005618 <span style="">│</span> 1992 <span style="">│</span> MFGR#121  <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     63389346096 <span style="">│</span> 1992 <span style="">│</span> MFGR#1210 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     ........... <span style="">│</span> .... <span style="">│</span> ..........<span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     39679892915 <span style="">│</span> 1998 <span style="">│</span> MFGR#128  <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     35300513083 <span style="">│</span> 1998 <span style="">│</span> MFGR#129  <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">└─────────────────┴──────┴───────────┘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>280 <span style="font-weight:bold;text-decoration:underline">rows</span> <span style="font-weight:bold;text-decoration:underline">in</span> <span style="font-weight:bold;text-decoration:underline">set</span>. Elapsed: 8.558 sec. Processed 600.04 million <span style="font-weight:bold;text-decoration:underline">rows</span>, 6.20 GB (70.11 million <span style="font-weight:bold;text-decoration:underline">rows</span>/s., 725.04 MB/s.)
</span></span></code></pre></div><p><strong>扫描行数：600,040,000</strong> <em>大约6亿</em></p>
<p><strong>耗时(秒)：8.558</strong></p>
<p><strong>查询列数：3</strong></p>
<p><strong>结果行数：280</strong></p>
<h4 class="heading" id="query-22">
  Query 2.2
  <a class="anchor" href="#query-22">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">SELECT</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">sum</span>(LO_REVENUE),
</span></span><span style="display:flex;"><span>    toYear(LO_ORDERDATE) <span style="font-weight:bold;text-decoration:underline">AS</span> <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    P_BRAND
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">FROM</span> lineorder_flat
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">WHERE</span> ((P_BRAND &gt;= <span style="color:#666;font-style:italic">&#39;MFGR#2221&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> (P_BRAND &lt;= <span style="color:#666;font-style:italic">&#39;MFGR#2228&#39;</span>)) <span style="font-weight:bold;text-decoration:underline">AND</span> (S_REGION = <span style="color:#666;font-style:italic">&#39;ASIA&#39;</span>)
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">GROUP</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    P_BRAND
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">ORDER</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span> <span style="font-weight:bold;text-decoration:underline">ASC</span>,
</span></span><span style="display:flex;"><span>    P_BRAND <span style="font-weight:bold;text-decoration:underline">ASC</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">┌─</span><span style="font-weight:bold;text-decoration:underline">sum</span>(LO_REVENUE)<span style="">─┬─</span><span style="font-weight:bold;text-decoration:underline">year</span><span style="">─┬─</span>P_BRAND<span style="">───┐</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     66450349438 <span style="">│</span> 1992 <span style="">│</span> MFGR#2221 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     65423264312 <span style="">│</span> 1992 <span style="">│</span> MFGR#2222 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     ........... <span style="">│</span> .... <span style="">│</span> ......... <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     39907545239 <span style="">│</span> 1998 <span style="">│</span> MFGR#2227 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span>     40654201840 <span style="">│</span> 1998 <span style="">│</span> MFGR#2228 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">└─────────────────┴──────┴───────────┘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>56 <span style="font-weight:bold;text-decoration:underline">rows</span> <span style="font-weight:bold;text-decoration:underline">in</span> <span style="font-weight:bold;text-decoration:underline">set</span>. Elapsed: 1.242 sec. Processed 600.04 million <span style="font-weight:bold;text-decoration:underline">rows</span>, 5.60 GB (482.97 million <span style="font-weight:bold;text-decoration:underline">rows</span>/s., 4.51 GB/s.) 
</span></span></code></pre></div><p><strong>扫描行数：600,040,000</strong> <em>大约6亿</em></p>
<p><strong>耗时(秒)：1.242</strong></p>
<p><strong>查询列数：3</strong></p>
<p><strong>结果行数：56</strong></p>
<h4 class="heading" id="query-31">
  Query 3.1
  <a class="anchor" href="#query-31">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">SELECT</span> 
</span></span><span style="display:flex;"><span>    C_NATION,
</span></span><span style="display:flex;"><span>    S_NATION,
</span></span><span style="display:flex;"><span>    toYear(LO_ORDERDATE) <span style="font-weight:bold;text-decoration:underline">AS</span> <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">sum</span>(LO_REVENUE) <span style="font-weight:bold;text-decoration:underline">AS</span> revenue
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">FROM</span> lineorder_flat
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">WHERE</span> (C_REGION = <span style="color:#666;font-style:italic">&#39;ASIA&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> (S_REGION = <span style="color:#666;font-style:italic">&#39;ASIA&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> (<span style="font-weight:bold;text-decoration:underline">year</span> &gt;= 1992) <span style="font-weight:bold;text-decoration:underline">AND</span> (<span style="font-weight:bold;text-decoration:underline">year</span> &lt;= 1997)
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">GROUP</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    C_NATION,
</span></span><span style="display:flex;"><span>    S_NATION,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">ORDER</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span> <span style="font-weight:bold;text-decoration:underline">ASC</span>,
</span></span><span style="display:flex;"><span>    revenue <span style="font-weight:bold;text-decoration:underline">DESC</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">┌─</span>C_NATION<span style="">──┬─</span>S_NATION<span style="">──┬─</span><span style="font-weight:bold;text-decoration:underline">year</span><span style="">─┬──────</span>revenue<span style="">─┐</span>
</span></span><span style="display:flex;"><span><span style="">│</span> INDIA     <span style="">│</span> INDIA     <span style="">│</span> 1992 <span style="">│</span> 537778456208 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> INDONESIA <span style="">│</span> INDIA     <span style="">│</span> 1992 <span style="">│</span> 536684093041 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> .....     <span style="">│</span> .......   <span style="">│</span> .... <span style="">│</span> ............ <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> CHINA     <span style="">│</span> CHINA     <span style="">│</span> 1997 <span style="">│</span> 525562838002 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> JAPAN     <span style="">│</span> VIETNAM   <span style="">│</span> 1997 <span style="">│</span> 525495763677 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">└───────────┴───────────┴──────┴──────────────┘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>150 <span style="font-weight:bold;text-decoration:underline">rows</span> <span style="font-weight:bold;text-decoration:underline">in</span> <span style="font-weight:bold;text-decoration:underline">set</span>. Elapsed: 3.533 sec. Processed 546.67 million <span style="font-weight:bold;text-decoration:underline">rows</span>, 5.48 GB (154.72 million <span style="font-weight:bold;text-decoration:underline">rows</span>/s., 1.55 GB/s.) 
</span></span></code></pre></div><p><strong>扫描行数：546,670,000</strong> <em>大约5亿4千多万</em></p>
<p><strong>耗时(秒)：3.533</strong></p>
<p><strong>查询列数：4</strong></p>
<p><strong>结果行数：150</strong></p>
<h4 class="heading" id="query-32">
  Query 3.2
  <a class="anchor" href="#query-32">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">SELECT</span> 
</span></span><span style="display:flex;"><span>    C_CITY,
</span></span><span style="display:flex;"><span>    S_CITY,
</span></span><span style="display:flex;"><span>    toYear(LO_ORDERDATE) <span style="font-weight:bold;text-decoration:underline">AS</span> <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">sum</span>(LO_REVENUE) <span style="font-weight:bold;text-decoration:underline">AS</span> revenue
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">FROM</span> lineorder_flat
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">WHERE</span> (C_NATION = <span style="color:#666;font-style:italic">&#39;UNITED STATES&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> (S_NATION = <span style="color:#666;font-style:italic">&#39;UNITED STATES&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> (<span style="font-weight:bold;text-decoration:underline">year</span> &gt;= 1992) <span style="font-weight:bold;text-decoration:underline">AND</span> (<span style="font-weight:bold;text-decoration:underline">year</span> &lt;= 1997)
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">GROUP</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    C_CITY,
</span></span><span style="display:flex;"><span>    S_CITY,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">ORDER</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span> <span style="font-weight:bold;text-decoration:underline">ASC</span>,
</span></span><span style="display:flex;"><span>    revenue <span style="font-weight:bold;text-decoration:underline">DESC</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">┌─</span>C_CITY<span style="">─────┬─</span>S_CITY<span style="">─────┬─</span><span style="font-weight:bold;text-decoration:underline">year</span><span style="">─┬────</span>revenue<span style="">─┐</span>
</span></span><span style="display:flex;"><span><span style="">│</span> UNITED ST6 <span style="">│</span> UNITED ST6 <span style="">│</span> 1992 <span style="">│</span> 5694246807 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> UNITED ST0 <span style="">│</span> UNITED ST0 <span style="">│</span> 1992 <span style="">│</span> 5676049026 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> .......... <span style="">│</span> .......... <span style="">│</span> .... <span style="">│</span> .......... <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> UNITED ST9 <span style="">│</span> UNITED ST9 <span style="">│</span> 1997 <span style="">│</span> 4836163349 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> UNITED ST9 <span style="">│</span> UNITED ST5 <span style="">│</span> 1997 <span style="">│</span> 4769919410 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">└────────────┴────────────┴──────┴────────────┘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>600 <span style="font-weight:bold;text-decoration:underline">rows</span> <span style="font-weight:bold;text-decoration:underline">in</span> <span style="font-weight:bold;text-decoration:underline">set</span>. Elapsed: 1.000 sec. Processed 546.67 million <span style="font-weight:bold;text-decoration:underline">rows</span>, 5.56 GB (546.59 million <span style="font-weight:bold;text-decoration:underline">rows</span>/s., 5.56 GB/s.)
</span></span></code></pre></div><p><strong>扫描行数：546,670,000</strong> <em>大约5亿4千多万</em></p>
<p><strong>耗时(秒)：1.00</strong></p>
<p><strong>查询列数：4</strong></p>
<p><strong>结果行数：600</strong></p>
<h4 class="heading" id="query-41">
  Query 4.1
  <a class="anchor" href="#query-41">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">SELECT</span> 
</span></span><span style="display:flex;"><span>    toYear(LO_ORDERDATE) <span style="font-weight:bold;text-decoration:underline">AS</span> <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    C_NATION,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">sum</span>(LO_REVENUE - LO_SUPPLYCOST) <span style="font-weight:bold;text-decoration:underline">AS</span> profit
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">FROM</span> lineorder_flat
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">WHERE</span> (C_REGION = <span style="color:#666;font-style:italic">&#39;AMERICA&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> (S_REGION = <span style="color:#666;font-style:italic">&#39;AMERICA&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> ((P_MFGR = <span style="color:#666;font-style:italic">&#39;MFGR#1&#39;</span>) <span style="font-weight:bold;text-decoration:underline">OR</span> (P_MFGR = <span style="color:#666;font-style:italic">&#39;MFGR#2&#39;</span>))
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">GROUP</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    C_NATION
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">ORDER</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span> <span style="font-weight:bold;text-decoration:underline">ASC</span>,
</span></span><span style="display:flex;"><span>    C_NATION <span style="font-weight:bold;text-decoration:underline">ASC</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">┌─</span><span style="font-weight:bold;text-decoration:underline">year</span><span style="">─┬─</span>C_NATION<span style="">──────┬────────</span>profit<span style="">─┐</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 1992 <span style="">│</span> ARGENTINA     <span style="">│</span> 1041983042066 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 1992 <span style="">│</span> BRAZIL        <span style="">│</span> 1031193572794 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> .... <span style="">│</span> ......        <span style="">│</span>  ............ <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 1998 <span style="">│</span> PERU          <span style="">│</span>  603980044827 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 1998 <span style="">│</span> UNITED STATES <span style="">│</span>  605069471323 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">└──────┴───────────────┴───────────────┘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>35 <span style="font-weight:bold;text-decoration:underline">rows</span> <span style="font-weight:bold;text-decoration:underline">in</span> <span style="font-weight:bold;text-decoration:underline">set</span>. Elapsed: 5.066 sec. Processed 600.04 million <span style="font-weight:bold;text-decoration:underline">rows</span>, 8.41 GB (118.43 million <span style="font-weight:bold;text-decoration:underline">rows</span>/s., 1.66 GB/s.)  
</span></span></code></pre></div><p><strong>扫描行数：600,040,000</strong> <em>大约6亿</em></p>
<p><strong>耗时(秒)：5.066</strong></p>
<p><strong>查询列数：4</strong></p>
<p><strong>结果行数：35</strong></p>
<h4 class="heading" id="query-42">
  Query 4.2
  <a class="anchor" href="#query-42">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">SELECT</span> 
</span></span><span style="display:flex;"><span>    toYear(LO_ORDERDATE) <span style="font-weight:bold;text-decoration:underline">AS</span> <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    S_NATION,
</span></span><span style="display:flex;"><span>    P_CATEGORY,
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">sum</span>(LO_REVENUE - LO_SUPPLYCOST) <span style="font-weight:bold;text-decoration:underline">AS</span> profit
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">FROM</span> lineorder_flat
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">WHERE</span> (C_REGION = <span style="color:#666;font-style:italic">&#39;AMERICA&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> (S_REGION = <span style="color:#666;font-style:italic">&#39;AMERICA&#39;</span>) <span style="font-weight:bold;text-decoration:underline">AND</span> ((<span style="font-weight:bold;text-decoration:underline">year</span> = 1997) <span style="font-weight:bold;text-decoration:underline">OR</span> (<span style="font-weight:bold;text-decoration:underline">year</span> = 1998)) <span style="font-weight:bold;text-decoration:underline">AND</span> ((P_MFGR = <span style="color:#666;font-style:italic">&#39;MFGR#1&#39;</span>) <span style="font-weight:bold;text-decoration:underline">OR</span> (P_MFGR = <span style="color:#666;font-style:italic">&#39;MFGR#2&#39;</span>))
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">GROUP</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span>,
</span></span><span style="display:flex;"><span>    S_NATION,
</span></span><span style="display:flex;"><span>    P_CATEGORY
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">ORDER</span> <span style="font-weight:bold;text-decoration:underline">BY</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">year</span> <span style="font-weight:bold;text-decoration:underline">ASC</span>,
</span></span><span style="display:flex;"><span>    S_NATION <span style="font-weight:bold;text-decoration:underline">ASC</span>,
</span></span><span style="display:flex;"><span>    P_CATEGORY <span style="font-weight:bold;text-decoration:underline">ASC</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">┌─</span><span style="font-weight:bold;text-decoration:underline">year</span><span style="">─┬─</span>S_NATION<span style="">──────┬─</span>P_CATEGORY<span style="">─┬───────</span>profit<span style="">─┐</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 1997 <span style="">│</span> ARGENTINA     <span style="">│</span> MFGR#11    <span style="">│</span> 102369950215 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 1997 <span style="">│</span> ARGENTINA     <span style="">│</span> MFGR#12    <span style="">│</span> 103052774082 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> .... <span style="">│</span> .........     <span style="">│</span> .......    <span style="">│</span> ............ <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 1998 <span style="">│</span> UNITED STATES <span style="">│</span> MFGR#24    <span style="">│</span>  60779388345 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">│</span> 1998 <span style="">│</span> UNITED STATES <span style="">│</span> MFGR#25    <span style="">│</span>  60042710566 <span style="">│</span>
</span></span><span style="display:flex;"><span><span style="">└──────┴───────────────┴────────────┴──────────────┘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>100 <span style="font-weight:bold;text-decoration:underline">rows</span> <span style="font-weight:bold;text-decoration:underline">in</span> <span style="font-weight:bold;text-decoration:underline">set</span>. Elapsed: 0.826 sec. Processed 144.42 million <span style="font-weight:bold;text-decoration:underline">rows</span>, 2.17 GB (174.78 million <span style="font-weight:bold;text-decoration:underline">rows</span>/s., 2.63 GB/s.)
</span></span></code></pre></div><p><strong>扫描行数：144,420,000</strong> <em>大约1亿4千多万</em></p>
<p><strong>耗时(秒)：0.826</strong></p>
<p><strong>查询列数：4</strong></p>
<p><strong>结果行数：100</strong></p>
<h2 class="heading" id="性能测试结果汇总">
  性能测试结果汇总
  <a class="anchor" href="#%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c%e6%b1%87%e6%80%bb">#</a>
</h2>

<div class="table-outer">
    <table>
        <thead>
            <tr>
                <th style="text-align: left">查询语句</th>
                <th style="text-align: left">SQL简要说明</th>
                <th style="text-align: right">扫描行数</th>
                <th style="text-align: right">返回行数</th>
                <th style="text-align: right">查询列数</th>
                <th style="text-align: right">耗时(秒)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align: left">Q1.1</td>
                <td style="text-align: left">乘积、汇总、4个条件、首次运行</td>
                <td style="text-align: right">91,010,000</td>
                <td style="text-align: right">1</td>
                <td style="text-align: right">2</td>
                <td style="text-align: right">0.242</td>
            </tr>
            <tr>
                <td style="text-align: left">Q1.2</td>
                <td style="text-align: left">Q1.1增加1个条件运行</td>
                <td style="text-align: right">7,750,000</td>
                <td style="text-align: right">1</td>
                <td style="text-align: right">2</td>
                <td style="text-align: right">0.040</td>
            </tr>
            <tr>
                <td style="text-align: left">Q2.1</td>
                <td style="text-align: left">汇总、函数、2列分组、2列排序、首次运行</td>
                <td style="text-align: right">600,040,000</td>
                <td style="text-align: right">280</td>
                <td style="text-align: right">3</td>
                <td style="text-align: right">8.558</td>
            </tr>
            <tr>
                <td style="text-align: left">Q2.2</td>
                <td style="text-align: left">Q2.1增加1个条件运行</td>
                <td style="text-align: right">600,040,000</td>
                <td style="text-align: right">56</td>
                <td style="text-align: right">3</td>
                <td style="text-align: right">1.242</td>
            </tr>
            <tr>
                <td style="text-align: left">Q3.1</td>
                <td style="text-align: left">汇总、函数、3列分组、2列排序、首次运行</td>
                <td style="text-align: right">546,670,000</td>
                <td style="text-align: right">150</td>
                <td style="text-align: right">4</td>
                <td style="text-align: right">3.533</td>
            </tr>
            <tr>
                <td style="text-align: left">Q3.2</td>
                <td style="text-align: left">Q3.1更换条件运行</td>
                <td style="text-align: right">546,670,000</td>
                <td style="text-align: right">600</td>
                <td style="text-align: right">4</td>
                <td style="text-align: right">1</td>
            </tr>
            <tr>
                <td style="text-align: left">Q4.1</td>
                <td style="text-align: left">相减、汇总、函数、2列分组、2列排序、首次运行</td>
                <td style="text-align: right">600,040,000</td>
                <td style="text-align: right">35</td>
                <td style="text-align: right">4</td>
                <td style="text-align: right">5.006</td>
            </tr>
            <tr>
                <td style="text-align: left">Q4.2</td>
                <td style="text-align: left">Q4.1增加2个条件运行</td>
                <td style="text-align: right">144,420,000</td>
                <td style="text-align: right">100</td>
                <td style="text-align: right">4</td>
                <td style="text-align: right">0.826</td>
            </tr>
        </tbody>
    </table>
</div><p>在当前软硬件环境下，扫描 6 亿多行数据，常见的分析语句首次运行最慢在 8 秒左右能返回结果，相同的分析逻辑更换条件再次查询的时候效率有明显的提升，可以缩短到 1 秒左右，如果只是简单的列查询没有加减乘除、聚合等逻辑，扫描全表 6 亿多行数据首次查询基本可以在 2 秒内执行完成。</p>
<blockquote>
<p>本文由本人原创。网络中有多处内容与本文相同的文章，皆为未授权盗用，请知悉。</p></blockquote>

    </div>
  </article>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">←</div>
                <div class="single-pagination-text">
                    <a href="/posts/the-ultimate-guide-to-redis-distributed-high-availability/">
                        Redis 分布式高可用终极指南
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/posts/getting-started-with-ffmpeg-encoding-and-editing/">
                        FFmpeg 编码和编辑入门
                    </a>
                </div>
                <div class="single-pagination-text">→</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
  <link rel="stylesheet" 
  href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css">
  
<script defer 
  src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script>

<script defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"
  onload="renderMathInElement(document.body);"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false }
      ]
    });
  });
</script>
  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
